<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    浏览器缓存(http缓存)的使用规则：
    1.浏览器每次发起请求，都会先在浏览器缓存中查找该请求的结果以及缓存标识
    2.浏览器每次拿到返回的请求结果都会将该结果和缓存标识存入浏览器缓存中

    强制缓存：向浏览器缓存查找该请求结果，并根据该结果的缓存规则来决定是否使用该缓存结果的过程
    强制缓存主要分为三种情况：
    1.不存在该缓存结果和缓存标识，强制缓存失效，则直接向服务器发起请求。
    2.存在该缓存结果和缓存标识，但该结果已失效，强制缓存失效，则使用协商缓存
    3.存在该缓存结果和缓存标识，且该结果尚未失效，强制缓存生效，直接返回该结果

    强制缓存的规则：当浏览器向服务器发起请求时，服务器会将缓存规则放入HTTP响应报文的HTTP头中和请求结果一起
    返回给浏览器，控制强制缓存的字段分别是Expires和Cache-Control，其中Cache-Control优先级比Expires高。

    Expires是HTTP/1.0控制网页缓存的字段，其值为服务器返回该请求结果缓存的到期时间，即再次发起该请求时，
    如果客户端的时间小于Expires的值时，直接使用缓存结果。
    在HTTP/1.1中，Cache-Control是最重要的规则，主要用于控制网页缓存

    协商缓存：是强制缓存失效后，浏览器携带缓存标识向服务器发起请求，由服务器根据缓存标识决定是否使用缓存的过程
    协商缓存主要分为两种情况：
    1.协商缓存生效，服务器返回304，表示该资源无更新，浏览器再向浏览器缓存获取请求的缓存结果
    2.协商缓存失效，服务器返回200和请求结果结果，浏览器再将新的请求结果和缓存标识放入浏览器缓存中

    为什么 Cache-Control 优先级比Expire 高呢？
    因为 Cache-Control (http1.1)相对于 Expires (http1.0)是个更新的技术， 而且使用 Expires 是存在bug 的。
    Expires 的bug：时间使用的是计算机本地的时间，如果某一天计算机时间错乱，本地时间一直在你设置的时间之后，
    那么他就永远使用不了缓存。

    补充：Etag 和 Last-Modified 字段
    1.E-tag则是对请求资源求MD5或者哈希值，绝对精确，只要有任何变化都能体现出来。
    2.LM根据文件修改时间来判断是否要重新返回整个文件。

    Etag主要为了解决Last-Modified无法解决的一些问题:
    1.一些文件也许周期性的更改,但是它的内容并不改变(仅仅改变的是修改时间),这个时候我们不希望客户端认为这个文件
    被修改了,而重新获取资源.
    2. 某些文件修改非常频繁,比如在秒一下的时间内进行修改(比如1s内修改了N次),If-Modified-Since能检查到的粒度是秒级的,
    这种修改是无法判断的(或者说UNIX记录MTIME只能精确到秒)。
</body>
</html>